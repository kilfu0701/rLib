"use strict";var _require=require("chrome"),Cc=_require.Cc,Ci=_require.Ci,Cu=_require.Cu,components=_require.components,_require2=require("../util/Object"),Object=_require2.Object,_require3=require("../util/Observer"),Observer=_require3.Observer,CSP=function(e){this.keys=["default-src","script-src","object-src","style-src","img-src","media-src","frame-src","font-src","connect-src"];var r={},t=!0,s=!1,i=void 0;try{for(var n,o=this.keys[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){var c=n.value;r[c]=c}}catch(a){s=!0,i=a}finally{try{!t&&o["return"]&&o["return"]()}finally{if(s)throw i}}var u={matchSites:[],pattern:["self","resource://*"],allowUnsafe:!0};this.options=Object.extend(u,e),this.replaceLists=r,this.unsafe_actions=["'unsafe-eval'","'unsafe-inline'"],this.Obs=new Observer({topicID:"http-on-examine-response",observeCallback:this._observeCallback()})};CSP.prototype.setOptions=function(e){return this.options=Object.extend(this.options,e),this.options},CSP.prototype._observeCallback=function(e,r,t){var s=this;return function(e,r,t){e.QueryInterface(Ci.nsIHttpChannel);var i=(e.URI.spec,s.options.pattern);s.options.allowUnsafe===!0&&i.concat(s.unsafe_actions);var n={};for(var o in s.replaceLists)n[o]=i.join(" ");var c="";try{c=e.getResponseHeader("content-security-policy");for(var a in n)c=c.replace(a,n[a]);e.setResponseHeader("content-security-policy",c,!1)}catch(u){}}},CSP.prototype.remove=function(){this.Obs&&"function"==typeof this.Obs.unregister&&this.Obs.unregister()},exports.CSP=CSP;