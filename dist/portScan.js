"use strict";function scan(e,r){e=e||"https://localhost:49155/getTowerInfo?_=",lg.log("[scan] url =",e),Request({url:e,onComplete:function(e){lg.log("[scan] resp =",e),"function"==typeof r&&r(e)},timeout:30}).get()}function autoScan(e){finished=!1,isScanning=!0,previous_port=ls.get("port_number"),lg.log("[autoScan] previous_port =",previous_port);var r=port_range.min,t=timers.setInterval(function(){if(finished)return lg.log("[autoScan] finished"),isScanning=!1,void timers.clearTimeout(t);if(max_requests>current_requests){if(current_requests++,r>port_range.max)return timers.clearTimeout(t),isScanning=!1,void(finished||(lg.log("[autoScan] wait ",timeForReScan/1e3," sec for next round ..."),timers.setTimeout(function(){autoScan(e)},timeForReScan)));var o="https://localhost:"+r+"/api/getTowerInfo?_=";lg.log("[autoScan] url =",o),Request({url:o,onComplete:function(r){current_requests--,lg.log("[autoScan] resp =",r.json,r.headers),"function"==typeof e&&r.json&&(lg.log("[autoScan] response.json =",r.json),"DP_TOWER"===r.json.service&&r.json.port_number&&(finished=!0,ls.set("port_number",r.json.port_number),e(r.json)))},timeout:1e3}).get(),r++}else lg.log("[autoScan] max req reach...")},5)}function setTimeForReScan(e){timeForReScan=e}var _require=require("sdk/request"),Request=_require.Request,timers=require("sdk/timers"),ls=require("./localStorage"),_require2=require("./logger"),logger=_require2.logger,_require3=require("./settings"),settings=_require3.settings,lg=new logger({debug_mode:settings.debug.mode,prefix:"[PS]"}),port_range={min:49152,max:49162},previous_port={https:0,wss:0},max_requests=1e3,current_requests=0,finished=!1,timeForReScan=3e4;exports.scan=scan,exports.autoScan=autoScan,exports.setTimeForReScan=setTimeForReScan;